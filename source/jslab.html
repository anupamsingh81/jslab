<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../css/c3.css">
	<link rel="stylesheet" type="text/css" href="../css/jquery-linedtextarea.css"/>
	<style>
	body, fieldset, div { font-size:large; }
	button , input { font-size:large; }
	textarea { width:95%; }
	fieldset { width:90%; height:98%; }
	</style>
  </head>
  <body>
   <div style="width:100%; height:400px;">
    <div style="width:50%;height:95%;float:left;">
     <fieldset>
      <legend>JavaScript</legend>
	  <center>
	  <!-- onkeyup="codekeyup(event)"-->
	  <textarea id="codebox" class="lined" style="height:80%" onkeyup="onLineNumber();" onmouseup="this.onkeyup();">
x = rnorm(1000, 5, 2);
toStr(x,2);
hist(x, "normalized", "x");
curve("dnorm(x, 5,2)", "N(5,2)");
</textarea>
      <div style="height:10px"></div>
      <div>
	    <input type="file" id="filebox" name="filebox" onchange="handleFileSelect"/>
	    <input type="radio" name="mode" value="code" checked="true"/>code
        <input type="radio" name="mode" value="line"/>line &nbsp;
        <button onclick="run()">run</button>
	  </div>
	  </center>
    </div>
    <div style="width:50%;height:95%;float:left;">
     <fieldset>
      <legend>Graph</legend>
      <div id="chart" style="height:95%"></div>
     </fieldset>
	</div>
   </div>
   <div style="width:98%;height:100px">
     <textarea id="msgbox" style="width:100%;height:100%"></textarea>
   </div>
    
   <script src="../js/d3.min.js" charset="utf-8"></script>
   <script src="../js/c3.min.js"></script>
   <script src="../js/jstat.min.js"></script>
   <script src="../js/numeric.min.js"></script>
   <script src="../js/jquery.min.js"></script>
   <script src="../js/jquery-linedtextarea.js"></script>
   <script src="../source/R.js"></script>
   <script>
   var filebox = document.getElementById('filebox');
   var codebox = document.getElementById('codebox');
   var msgbox  = document.getElementById('msgbox');
   var lineNo  = 1;
   var mode, code, lines, results;
   
   function msgClear() { msgbox.value = ""; }
   
   function getRadioValue(name) {
     return document.querySelector('input[name='+name+']:checked').value;
   }

   function handleFileSelect(evt) {
	  msgClear();
	  var reader = new FileReader();
	  reader.onload = function(e) {
		codebox.value = reader.result;
	    run();
      };
      reader.readAsText(evt.target.files[0]);
	}
	
	filebox.addEventListener('change', handleFileSelect, false);

    function onLineNumber() {
     if (mode === "line") {
      lineNo = codebox.value.substr(0, codebox.selectionStart).split("\n").length;
      var msg = "";
	  if (lineNo < results.length) {
	    var r = results[lineNo];
		msg += "line "+lineNo+" : "+lines[lineNo];
		if (r.error !== null)
		  msg += "\nerror  : "+r.error;
	    msg += "\nreturn : "+r.value;
	  }
	  msgbox.value = msg;
	 }
    }
	
    function run() {
      code = codebox.value.trim();
	  mode = getRadioValue("mode");
      msgbox.value = "running...";
	  if (mode === "code") {
        try { 
          eval("newGraph();"+code);
		} catch (e) {
		  msgbox.value = "error  : ";
		  if (typeof(e.lineNumber) !== "undefined")
		    msgbox.value += "line="+e.lineNumber+" column="+e.columnNumber;
		  msgbox.value += "\nmessage : "+e.message;
		}
	  } else {
        lines = ["newGraph()"].concat(code.split("\n"));
	    results = [];
	    for (var i in lines) {
	      var v = null, e=null;
	      try { 
		    v=eval(lines[i]); 
		  } catch (error) {
		    e=error;
		  }
	      results.push({value:v,error:e});
	    }
	  }
	  msgbox.value += "finished!";
    }
	
	run();
   </script>
   <script>
    $(function() {
	  $(".lined").linedtextarea(
		{selectedLine: -1}
	  );
    });
   </script>	
 </body>
</html>

<!--

var Ax = R.rnorm(100, 10, 2);
var Ay = R.rnorm(100, 10, 2);
var Bx = R.rnorm(100, 0, 1);
var By = R.rnorm(100, 0, 1);
var g  = new G();
g.plot("A", Ax, Ay);
g.plot("B", Bx, By);
g.show();

/*
var g  = new G();
g.curve("normal", -5, 15, 1, fnorm);
g.curve("uniform",-5, 15, 1, funif);
R.log("%j", g.g);
g.show();
*/

	var g  = new G();
	var funif = function(x) { return dunif(x, 2, 6); }
	var fnorm = function(x) { return dnorm(x, 10, 2); }
    g.curve("normal", -5, 15, 0.1, fnorm);
    g.curve("uniform",-5, 15, 0.1, funif);
    C.log(""+g.g);
	var Ax = rnorm(100, 10, 1);
	C.log("Ax="+Ax);
	var Ay = rnorm(100, 0, 0.5);
	var Bx = rnorm(100, 0, 1);
	var By = rnorm(100, 0, 0.5);
	g.plot("A", Ax, Ay);
	g.plot("B", Bx, By);
	var Cx = rnorm(1000, 10, 2);
	g.hist("norm(10,2)", 5, 15, 0.8, Cx, "normalized");
	C.log(g);
	g.show();

//	var C = console;
	C.log("R.dnorm(9, 10, 2)="+dnorm(9, 10, 2));
	
	var g  = new G();

    g.curve("T3", -5, 5, 0.1, function(x) { return dt(x, 3); });
    g.curve("T10", -5, 5, 0.1, function(x) { return dt(x, 10); });
    g.curve("T25", -5, 5, 0.1, function(x) { return dt(x, 25); });
	
//    g.curve("normal", 5, 15, 0.1, function(x) { return dnorm(x, 10, 2); });
/*
	var funif = function(x) { return dunif(x, 2, 6); }
	var fnorm = function(x) { return dnorm(x, 10, 2); }
    g.curve("normal", -5, 15, 0.1, fnorm);
    g.curve("uniform",-5, 15, 0.1, funif);
    C.log(""+g.g);
	var Ax = rnorm(100, 10, 1);
	C.log("Ax="+Ax);
	var Ay = rnorm(100, 0, 0.5);
	var Bx = rnorm(100, 0, 1);
	var By = rnorm(100, 0, 0.5);
	g.plot("A", Ax, Ay);
	g.plot("B", Bx, By);
*/	
	
	var Cx = rnorm(1000, 10, 2);
//	g.hist("norm(10,2)", 5, 15, 0.8, Cx);
	
	C.log(JSON.stringify(g.g));
	g.show();

/*	var g  = new G();
	var fnorm = function(x) { return R.dnorm(x, 10, 2); }
	var x = R.rnorm(1000, 10, 2);
//	g.hist("norm(10,2)", 5, 15, 0.8, x);
    g.curve("norm(10,2)", 5, 15, 0.1, fnorm);
	C.log(JSON.stringify(g.g));	
	g.show();
*/	
/*	 
	function codekeyup(event) {
      if (event.keyCode == 13) {
		var lines = codebox.value.trim().split("\n");
		var lastLine  = lines.pop().trim();
		if (lastLine.substring(0,2) !== "//") {
		  var result = eval(lastLine);
//		  C.log("lastLine="+lastLine+" result="+result);
		  if (lastLine.indexOf("=")<0 && typeof(result)!=="undefined")
 	        codebox.value = codebox.value+"// "+result+"\n";
		}
		codebox.scrollTop = codebox.scrollHeight;
	  } else {
        return true;
      }
	}
*/
	
-->
